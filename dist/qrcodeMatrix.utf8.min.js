
/*!
 * qrcode-matrix v0.1.1
 * (c) 2018-present cnwhy <w.why@163.com>
 * Homepage https://github.com/cnwhy/QRCode-matrix
 * Released under the License MIT
 */
!function(t,r){"object"==typeof exports&&"undefined"!=typeof module?module.exports=r():"function"==typeof define&&define.amd?define(r):t.qrcodeMatrix=r()}(this,function(){"use strict";var n,e,g,t=function(t){for(var r=[],n=0;n<t.length;n++){var e=t.charCodeAt(n);e<128?r.push(e):e<2048?r.push(192|e>>6,128|63&e):e<55296||57344<=e?r.push(224|e>>12,128|e>>6&63,128|63&e):(n++,e=65536+((1023&e)<<10|1023&t.charCodeAt(n)),r.push(240|e>>18,128|e>>12&63,128|e>>6&63,128|63&e))}return r},r=function(o){return o="function"==typeof o?o:t,function(t){var r=t+"",n=r==t?o(r):t,e={};return n=n instanceof Array?n:[],e.getMode=function(){return 4},e.getLength=function(t){return n.length},e.write=function(t){for(var r=0;r<n.length;r++)t.put(n[r],8)},e}},o={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},c={L:1,M:0,Q:3,H:2},h=(n=[function(t,r){return(t+r)%2==0},function(t,r){return t%2==0},function(t,r){return r%3==0},function(t,r){return(t+r)%3==0},function(t,r){return(Math.floor(t/2)+Math.floor(r/3))%2==0},function(t,r){return t*r%2+t*r%3==0},function(t,r){return(t*r%2+t*r%3)%2==0},function(t,r){return(t*r%3+(t+r)%2)%2==0}],function(t){var r=n[t];if(!r)throw new Error("maskPattern:"+t);return r}),i=((e={})[o.MODE_NUMBER]=[10,12,14],e[o.MODE_ALPHA_NUM]=[9,11,13],e[o.MODE_8BIT_BYTE]=[8,16,16],e[o.MODE_KANJI]=[8,10,12],function(t,r){if(1<=r&&r<=40){var n=e[t];if(!n)throw"mode:"+t;return n[r<=9?0:r<=26?1:2]}throw new Error("type:"+r)}),l=function(t){return(t.length-17)/4},p=1335,f=7973,v=function(t){for(var r=0;0!=t;)r++,t>>>=1;return r},s=function(){var n=[],e=0,o={getBuffer:function(){return n},getAt:function(t){var r=7-t%8;return 1==(n[~~(t/8)]>>>r&1)},put:function(t,r){if((r=~~r)<0)throw new Error("length:"+r);for(;r--;)o.putBit(1==(t>>>r&1))},getLengthInBits:function(){return e},putBit:function(t){var r=~~(e/8);n.length<=r&&n.push(0),t&&(n[r]|=128>>>e%8),e+=1}};return o},u=function(t,r,n){a(t,r-1,n-1,!1,9),a(t,r,n,!0,7),a(t,r+1,n+1,!1,5),d(t,r+2,n+2,!0,3)},a=function(e,o,u,a,f){var i=e.length;function t(t,r){for(var n=f;--n;)u+=r,(o+=t)<0||u<0||i<=o||i<=u||(e[o][u]=a)}f<0||(o<0||u<0||i<=o||i<=u||(e[o][u]=a),1<f&&(t(1,0),t(0,1),t(-1,0),t(0,-1)))},d=function(t,r,n,e,o){for(;0<o;)a(t,r++,n++,e,o),o-=2},m=(g=[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],function(t,r){r=r||l(t);for(var n=g[r-1],e=0;e<n.length;e++)for(var o=0;o<n.length;o++){var u=n[e],a=n[o];if(null==t[u][a])for(var f=-2;f<=2;f++)for(var i=-2;i<=2;i++)t[u+f][a+i]=-2==f||2==f||-2==i||2==i||0==f&&0==i}});var M,A=(M=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12,7,37,13],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],function(t,r){for(var n=function(t,r){switch(r){case c.L:return M[4*(t-1)+0];case c.M:return M[4*(t-1)+1];case c.Q:return M[4*(t-1)+2];case c.H:return M[4*(t-1)+3];default:throw"bad rs block @ typeNumber:"+t+"/errorCorrectionLevel:"+r}}(t,r),e=n.length/3,o=[],u=0;u<e;u+=1)for(var a=n[3*u+0],f=n[3*u+1],i=n[3*u+2],g=0;g<a;g+=1)o.push({totalCount:f,dataCount:i});return o}),L=function(t){for(var r=y([1],0),n=0;n<t;n+=1)r=r.multiply(y([1,P.gexp(n)],0));return r},y=function(e,o){if(void 0===e.length)throw e.length+"/"+o;var r=function(){for(var t=0;t<e.length&&0==e[t];)t+=1;for(var r=new Array(e.length-t+o),n=0;n<e.length-t;n+=1)r[n]=e[n+t];return r}(),u={getAt:function(t){return r[t]},getLength:function(){return r.length},multiply:function(t){for(var r=new Array(u.getLength()+t.getLength()-1),n=0;n<u.getLength();n+=1)for(var e=0;e<t.getLength();e+=1)r[n+e]^=P.gexp(P.glog(u.getAt(n))+P.glog(t.getAt(e)));return y(r,0)},mod:function(t){if(u.getLength()-t.getLength()<0)return u;for(var r=P.glog(u.getAt(0))-P.glog(t.getAt(0)),n=new Array(u.getLength()),e=0;e<u.getLength();e+=1)n[e]=u.getAt(e);for(e=0;e<t.getLength();e+=1)n[e]^=P.gexp(P.glog(t.getAt(e))+r);return y(n,0).mod(t)}};return u},P=function(){for(var r=new Array(256),n=new Array(256),t=0;t<8;t+=1)r[t]=1<<t;for(t=8;t<256;t+=1)r[t]=r[t-4]^r[t-5]^r[t-6]^r[t-8];for(t=0;t<255;t+=1)n[r[t]]=t;var e={glog:function(t){if(t<1)throw"glog("+t+")";return n[t]},gexp:function(t){for(;t<0;)t+=255;for(;256<=t;)t-=255;return r[t]}};return e}(),w=function(t,r){for(var n=0,e=0;e<r.length;e+=1)n+=r[e].dataCount;if(t.getLengthInBits()>8*n)throw"code length overflow. ("+t.getLengthInBits()+">"+8*n+")";for(t.getLengthInBits()+4<=8*n&&t.put(0,4);t.getLengthInBits()%8!=0;)t.putBit(!1);for(;!(t.getLengthInBits()>=8*n||(t.put(236,8),t.getLengthInBits()>=8*n));)t.put(17,8);return function(t,r){for(var n=0,e=0,o=0,u=new Array(r.length),a=new Array(r.length),f=0;f<r.length;f+=1){var i=r[f].dataCount,g=r[f].totalCount-i;e=Math.max(e,i),o=Math.max(o,g),u[f]=new Array(i);for(var c=0;c<u[f].length;c+=1)u[f][c]=255&t.getBuffer()[c+n];n+=i;var l=L(g),h=y(u[f],l.getLength()-1).mod(l);for(a[f]=new Array(l.getLength()-1),c=0;c<a[f].length;c+=1){var p=c+h.getLength()-a[f].length;a[f][c]=0<=p?h.getAt(p):0}}var v=0;for(c=0;c<r.length;c+=1)v+=r[c].totalCount;var s=new Array(v),d=0;for(c=0;c<e;c+=1)for(f=0;f<r.length;f+=1)c<u[f].length&&(s[d]=u[f][c],d+=1);for(c=0;c<o;c+=1)for(f=0;f<r.length;f+=1)c<a[f].length&&(s[d]=a[f][c],d+=1);return s}(t,r)},B=function(t,r,n,e){var o=A(t,r),u=s(),a=n;u.put(e,4),u.put(a.length,i(e,t));for(var f=0;f<a.length;f++)u.put(a[f],8);return w(u,o)},T=function(t,r,n){for(var e=A(t,r),o=s(),u=0;u<n.length;u+=1){var a=n[u];o.put(a.getMode(),4),o.put(a.getLength(),i(a.getMode(),t)),a.write(o)}return w(o,e)},E={QRMode:o,QRErrorCorrectionLevel:c,QRMaskPattern:{PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},qrBitBuffer:s,setupAllPositionProbePattern:function(t){var r=t.length;u(t,0,0),u(t,r-7,0),u(t,0,r-7)},setupPositionAdjustPattern:m,setupTimingPattern:function(t){for(var r=t.length,n=8;n<r-8;n+=1)null==t[n][6]&&(t[n][6]=n%2==0);for(var e=8;e<r-8;e+=1)null==t[6][e]&&(t[6][e]=e%2==0)},setupTypeInfo:function(t,r,n,e){for(var o=t.length,u=function(t){for(var r=t<<10;0<=v(r)-v(p);)r^=p<<v(r)-v(p);return 21522^(t<<10|r)}(n<<3|e),a=0;a<15;a+=1){var f=!r&&1==(u>>a&1);a<6?t[a][8]=f:a<8?t[a+1][8]=f:t[o-15+a][8]=f}for(a=0;a<15;a+=1)f=!r&&1==(u>>a&1),a<8?t[8][o-a-1]=f:a<9?t[8][15-a-1+1]=f:t[8][15-a-1]=f;t[o-8][8]=!r},setupTypeNumber:function(t,r,n){n=n||l(t);for(var e=t.length,o=function(t){for(var r=t<<12;0<=v(r)-v(f);)r^=f<<v(r)-v(f);return t<<12|r}(n),u=0;u<18;u+=1){var a=!r&&1==(o>>u&1);t[Math.floor(u/3)][u%3+e-8-3]=a}for(u=0;u<18;u+=1)a=!r&&1==(o>>u&1),t[u%3+e-8-3][Math.floor(u/3)]=a},mapInit:function(r){try{var t=[],n=[];for(n.length=r;r--;)t.push(n.slice(0));return t}catch(t){console.log(r)}},copyMap:function(t){return t.map(function(t){return t.slice(0)})},compareMap:function(o,u,t){t=t||"and";for(var r=[],n=function(){switch(t){case"or":case"|":return function(t,r){var n=o[t][r],e=u[t][r];return!(!n&&!e)||!1!==n&&!1!==e&&void 0};case"xor":case"^":return function(t,r){var n=o[t][r],e=u[t][r];if(n!==e)return n||e};case"and":case"&":return function(t,r){var n=o[t][r],e=u[t][r];return!(!n||!e)||(!1!==n||!1!==e)&&void 0};default:throw"type err!"}}(),e=0;e<o.length;e++){r[e]=[];for(var a=0;a<o.length;a++)r[e][a]=n(e,a)}return r},createData:function(t,r,n,e){return(e?B:T).apply(null,arguments)},mapData:function(t,r,n){for(var e=t.length,o=-1,u=e-1,a=7,f=0,i=h(n),g=e-1;0<g;g-=2)for(6==g&&(g-=1);;){for(var c=0;c<2;c+=1)if(null==t[u][g-c]){var l=!1;f<r.length&&(l=1==(r[f]>>>a&1)),i(u,g-c)&&(l=!l),t[u][g-c]=l,-1==(a-=1)&&(f+=1,a=7)}if((u+=o)<0||e<=u){u-=o,o=-o;break}}return t},getLengthInBits:i,getRSBlocks:A,getLostPoint:function(n){for(var t=n.length,r=0,e=function(t,r){return n[t][r]},o=0;o<t;o+=1)for(var u=0;u<t;u+=1){for(var a=0,f=e(o,u),i=-1;i<=1;i+=1)if(!(o+i<0||t<=o+i))for(var g=-1;g<=1;g+=1)u+g<0||t<=u+g||0==i&&0==g||f==e(o+i,u+g)&&(a+=1);5<a&&(r+=3+a-5)}for(o=0;o<t-1;o+=1)for(u=0;u<t-1;u+=1){var c=0;e(o,u)&&(c+=1),e(o+1,u)&&(c+=1),e(o,u+1)&&(c+=1),e(o+1,u+1)&&(c+=1),0!=c&&4!=c||(r+=3)}for(o=0;o<t;o+=1)for(u=0;u<t-6;u+=1)e(o,u)&&!e(o,u+1)&&e(o,u+2)&&e(o,u+3)&&e(o,u+4)&&!e(o,u+5)&&e(o,u+6)&&(r+=40);for(u=0;u<t;u+=1)for(o=0;o<t-6;o+=1)e(o,u)&&!e(o+1,u)&&e(o+2,u)&&e(o+3,u)&&e(o+4,u)&&!e(o+5,u)&&e(o+6,u)&&(r+=40);var l=0;for(u=0;u<t;u+=1)for(o=0;o<t;o+=1)e(o,u)&&(l+=1);return r+=Math.abs(100*l/t/t-50)/5*10}},b=E.QRErrorCorrectionLevel,I={};return function(s,d){function t(t){t=t||{};var a,f,i,e,g,c,l,o,h,n,u,p,r,v=Object.assign({},d,t);return a=v.typeNumber,f=v.minTypeNumber,i=v.maskPattern,e=v.dataMode,g=function(){var t=v.errorCorrectionLevel;for(var r in b){var n=b[r];if(t===r||+t===n)return n}}(),c=0,l=[],o=null,h=function(t,r){var n;return I["basemap_"+a]?n=E.copyMap(I["basemap_"+a]):(n=E.mapInit(c),E.setupAllPositionProbePattern(n),E.setupPositionAdjustPattern(n),E.setupTimingPattern(n),I["basemap_"+a]=E.copyMap(n)),E.setupTypeInfo(n,t,g,r),7<=a&&E.setupTypeNumber(n,t),null==o&&(o=E.createData(a,g,l)),E.mapData(n,o,r)},n=function(t,r){var n=null;if("function"==typeof(r=r||e)){if(!((n=r(t)).getMode&&n.getLength&&n.write))throw"mode invalid!"}else{if(!s[r])throw"mode type invalid! mode is "+r;n=s[r](t)}l.push(n),o=null},u=function(){if(a<1){for(var t=f||1;t<40;t++){for(var r=E.getRSBlocks(t,g),n=E.qrBitBuffer(),e=0;e<l.length;e++){var o=l[e];n.put(o.getMode(),4),n.put(o.getLength(),E.getLengthInBits(o.getMode(),t)),o.write(n)}var u=0;for(e=0;e<r.length;e++)u+=r[e].dataCount;if(n.getLengthInBits()<=8*u)break}a=t}return c=4*a+17,"random"===i?i=~~(8*Math.random()):0<=i&&i<=7?i>>=0:i=function(){for(var t=0,r=0,n=0;n<8;n+=1){var e=h(!0,n),o=E.getLostPoint(e);(0==n||o<t)&&(t=o,r=n)}return r}(),h(!1,i)},(r=function(t,r){return p(t,r),u()}).setData=p=function(t,r){l=[],n(t,r)},r.addData=n,r.make=u,r.splitMake=function(){var t={};t.all=u(),t.allDiscover=E.copyMap(I["basemap_"+a]),t.positionProbe=E.mapInit(c),E.setupAllPositionProbePattern(t.positionProbe);var r=E.copyMap(t.positionProbe);E.setupPositionAdjustPattern(r),t.positionAdjust=E.compareMap(t.positionProbe,r,"xor");var n=E.mapInit(c);return E.setupTimingPattern(n),t.timing=E.compareMap(t.positionAdjust,n,"and"),t.timing=E.compareMap(t.timing,n,"xor"),t.data=E.compareMap(t.all,t.allDiscover,"xor"),t},r}return t.QRModes=s,t.QRErrorCorrectionLevel=b,t}({Byte:r()},{errorCorrectionLevel:"M",typeNumber:0,maskPattern:"auto",dataMode:"Byte"})});